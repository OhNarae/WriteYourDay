<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mappers.memo">

	<select id="getMemoSetList" resultType="vo.MemoSetVO">
		select ms.* from
		MEMO_SET_TB ms join MEMBER_TB mb on ms.member_seq = mb.seq where mb.id = #{id}
	</select>

	<insert id="insertMemoSet">
		insert into MEMO_SET_TB(member_seq, seq, name)
		values( #{member_seq}, (select nvl(max(seq), 0)+1 from MEMO_SET_TB where member_seq = #{member_seq}), #{name})
	</insert>
	
	<update id="updateMemoSet">
		update MEMO_SET_TB set name = #{name}
		where seq = #{seq}
	</update>

	<select id="getMemoList" resultType="vo.MemoVO">
		select * from
		MEMO_TB where set_seq = #{seq}
	</select>

	<select id="getMemo" resultType="vo.MemoVO">
		select set_seq, seq, name,
		contents from MEMO_TB where set_seq = #{set_seq} 
			<if test="seq > 0">and seq = #{seq}</if>
			<if test="name != null">and name = #{name}</if>
	</select>

	<insert id="insertMemo">
		insert into MEMO_TB(set_seq, seq, name, contents)
		values(#{set_seq}, (select nvl(max(seq), 0)+1 from MEMO_TB where set_seq = #{set_seq}), #{name}
			, #{contents})
		
<!-- 		<selectKey keyProperty="seq" resultType="Integer" order="AFTER">
			select nvl(max(seq), 0) from MEMO_TB where set_seq = #{set_seq}
		</selectKey> -->
	</insert>

	<update id="updateMemo">		
		update MEMO_TB set 
			<if test="name != null">name=#{name}</if>
			<if test="contents != null"><if test="name != null">,</if>contents=#{contents}</if>
		where set_seq = #{set_seq} and seq = #{seq}
	</update>
</mapper>